<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ... (el resto del código permanece igual) ... -->
</head>
<body>
    <!-- ... (navbar y sidebar permanecen igual) ... -->

    <!-- Pestaña Notas -->
    <div class="tab-pane fade" id="notas">
        <div class="block-home">
            <div class="titol" style="background-color: #28a745;">
                <i class="fas fa-sticky-note fa-lg"></i> Notas
            </div>
            <div class="links">
                <!-- Cambiar id del textarea a "textareaNotas" -->
                <textarea id="textareaNotas" class="form-control" rows="5" placeholder="Escribe tus notas aquí..."></textarea>
                <button class="btn btn-primary mt-2" onclick="guardarNotas()">Guardar Nota</button>
                <div class="saved-entries" id="savedNotas"></div>
            </div>
        </div>
    </div>

    <!-- Pestaña Mensajes -->
    <div class="tab-pane fade" id="mensajes">
        <div class="block-home">
            <div class="titol" style="background-color: #dc3545;">
                <i class="fas fa-comment fa-lg"></i> Mensajes
            </div>
            <div class="links">
                <!-- Cambiar id del textarea a "textareaMensajes" -->
                <textarea id="textareaMensajes" class="form-control" rows="5" placeholder="Escribe tus mensajes aquí..."></textarea>
                <button class="btn btn-primary mt-2" onclick="guardarMensajes()">Guardar Mensaje</button>
                <div class="saved-entries" id="savedMensajes"></div>
            </div>
        </div>
    </div>

    <!-- ... (el resto del HTML permanece igual) ... -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Calendario
            var calendarEl = document.getElementById('calendario');
            if (!calendarEl) {
                console.error('Elemento #calendario no encontrado');
                return;
            }

            // Validar y sanitizar eventos almacenados
            let events = [];
            try {
                const storedEvents = localStorage.getItem('eventos');
                if (storedEvents) {
                    events = JSON.parse(storedEvents);
                    // Filtrar eventos con fechas válidas
                    events = events.filter(event => 
                        event && 
                        typeof event.title === 'string' && 
                        event.title.trim() !== '' && 
                        event.start && 
                        typeof event.start === 'string' &&
                        !isNaN(Date.parse(event.start)) // Validar fecha
                    );
                }
            } catch (error) {
                console.error('Error al parsear eventos:', error);
                events = [];
                localStorage.removeItem('eventos');
            }

            // Inicializar FullCalendar
            try {
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    // ... (configuración existente) ...
                });
                calendar.render();
            } catch (error) {
                console.error('Error al cargar FullCalendar:', error);
            }

            // Cargar notas y mensajes
            cargarNotas();
            cargarMensajes();
            inicializarDibujo();
        });

        // Función guardarNotas actualizada
        function guardarNotas() {
            const notasText = document.getElementById('textareaNotas').value; // Usar el nuevo id
            // ... (resto del código) ...
        }

        // Función guardarMensajes actualizada
        function guardarMensajes() {
            const mensajesText = document.getElementById('textareaMensajes').value; // Usar el nuevo id
            // ... (resto del código) ...
        }

        // ... (resto de funciones permanecen igual) ...
    </script>
</body>
</html>
